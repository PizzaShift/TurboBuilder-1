RewriteEngine on

# Redirect non https to https
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirect the www version to NO www
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

# Prevent resources hotlinking (Bandwith stealing by using them on another websites)
#RewriteCond %{HTTP_REFERER} !^$
#RewriteCond %{HTTP_REFERER} ^https?://(www\.)?([^/]+)/.*$ [NC]
#RewriteCond %2#%{HTTP_HOST} !^(.+)#(www\.)?\1$ [NC]
#RewriteRule \.(js|bmp|gif|jpe?g|png)$ - [F,L,NC]

# Redirect all root file urls (that do not have a slash and have a dot) to the site folder
RewriteRule ^([^/]*)\.(.*)$ site/$1.$2 [L]

# Redirect all urls to the index entry point
RewriteCond %{REQUEST_URI} !site/ [NC]
RewriteCond %{REQUEST_URI} !resources/ [NC]
RewriteCond %{REQUEST_URI} !storage [NC]
RewriteRule ^(.*)$ site/index.php?q=$1 [L]

# Redirect resources to the resources folder
RewriteRule ^resources/(.*)$ site/resources/$1 [L]

# Redirect 404 errors to the error page
ErrorDocument 404 /site/error-404.php


# CUSTOM RULES - HERE