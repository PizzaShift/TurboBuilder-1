RewriteEngine on

# Redirect 404 errors to the error page
ErrorDocument 404 /site/error-404.php

# Redirect all allowed static files to the site folder
RewriteCond %{REQUEST_URI} !site/
RewriteCond %{REQUEST_URI} !cache/
RewriteCond %{REQUEST_URI} !data/storage/
RewriteRule ^(.*)\.(.{1,5})$ site/$1.$2 [L]

# Redirect all executable urls to the index entry point
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ site/index.php?q=$1 [L]

# any php file that is not index will throw a 404 error
RewriteCond %{REQUEST_URI} !site/index.php [NC]
RewriteCond %{REQUEST_URI} !/site/error-404.php [NC]
RewriteRule ^(.*)\.php$ - [L,R=404]